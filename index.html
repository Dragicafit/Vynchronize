<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <!-- Socket.io -->
    <script src="/js/dependencies/socket.io.js"></script>

    <!-- Custom styles for this template -->
    <link href="css/small-business.css" rel="stylesheet">

    <link href="css/style.css" rel="stylesheet">
    <link href="css/mobile-style.css" rel="stylesheet">
    <link href="css/html5player.css" rel="stylesheet">

</head>

<body class="bg-light" id="Home">

    <!-- Page Content -->
    <div class="container">

        <!-- Loading page -->
        <!-- Loader is currently dependent on the dailymotion api because it is the slowest -->
        <div id="loading"></div>

        <!-- User Form (First Page) -->
        <div id="userFormArea" class="row">
            <div class="col-md-12">
                <h2> Join a Room! </h2>
                <form id="userForm">
                    <div class="form-group">
                        <p style="color:red; margin-bottom: 0px" id="missinginfo"></p>
                        <label>Enter Name</label>
                        <input class="form-control" id="username" />
                        <br />
                        <p style="color:red; margin-bottom: 0px" id="missinginfo2"></p>
                        <label>Enter Room ID (Default 1)</label>
                        <button type="button" onClick="randomroom()" class="btn btn-primary random">Random</button>
                        <br />
                        <input class="form-control" id="roomnum" />
                        <br />

                        <input style="margin-top: 10px;" type="submit" class="btn btn-primary" value="Enter" />
                        <hr style="height:65pt; visibility:hidden;" />
                    </div>
                </form>
            </div>
        </div>

        
    </div>
    <script>
        var socket = io.connect();
        var roomnum = 1
        var id = "M7lc1UVf-VE"
        var username = ""
        // Don't allow trailing or leading whitespace!
        var nosymbols = new RegExp("^(([a-zA-Z0-9_-][a-zA-Z0-9 _-]*[a-zA-Z0-9_-])|([a-zA-Z0-9_-]*))$");

        // Remove the video from the queue at idx
        function removeAt(idx) {
            socket.emit('remove at', {
                idx: idx
            })
        }

        function playAt(idx) {
            socket.emit('play at', {
                idx: idx
            }, function (data) {
                var videoId = data.videoId

                // Change the video
                socket.emit('change video', {
                    room: roomnum,
                    videoId: videoId,
                    time: 0
                })
            })
        }


        // playlist
        $(document).ready(function () {
            $(".arrow-right").bind("click", function (event) {
                event.preventDefault();
                $(".vid-list-container").stop().animate({
                    scrollLeft: "+=336"
                }, 750);
            });
            $(".arrow-left").bind("click", function (event) {
                event.preventDefault();
                $(".vid-list-container").stop().animate({
                    scrollLeft: "-=336"
                }, 750);
            });
        });

        // set id
        socket.on('set id', function (data) {
            // Ensure no valid id too
            if (data.id != "" && nosymbols.test(data.id)) {
                document.getElementById('roomnum').value = data.id
                // Probably should not force it to be readonly
                // document.getElementById('roomnum').readOnly = true
                console.log("You are joining room: " + data.id)
            }
            // Reset url for next person
            // Workaround
            socket.emit('reset url')
        });

        function copyInvite() {
            /* Get the text field */
            var copyText = document.getElementById("inv_input");
            console.log(copyText)
            /* Select the text field */
            copyText.select();
            /* Copy the text inside the text field */
            document.execCommand("Copy");
            /* Alert the copied text */
            // alert("Copied the text: " + copyText.value);
            var tooltip = document.getElementById("myTooltip");
            tooltip.innerHTML = "Copied!";
        }

        function outFunc() {
            var tooltip = document.getElementById("myTooltip");
            tooltip.innerHTML = "Copy to clipboard";
        }

        // Generate a random alphanumeric room id
        function randomroom() {
            document.getElementById('roomnum').value = Math.random().toString(36).substr(2, 12)
        }
    </script>


    <script>
        browser.tabs.query({ url: 'http://localhost/*', visible: true, active: true }).executeScript({
            // Bootstrap core JavaScript
            file: "/js/dependencies/jquery.min.js",
            file: "/js/dependencies/bootstrap.bundle.min.js",
            file: "/js/dependencies/scrolling-nav.js",
            file: "/js/dependencies/bootstrap-notify.min.js",
            // Plugin JavaScript
            file: "/js/dependencies/jquery.easing.min.js",
            // My JS files
            file: "/js/sync.js",
            file: "/js/player.js",
            file: "/js/host.js",
            file: "/js/events.js",
            file: "/js/notify.js",
            // Youtube
            file: "js/yt.js",
            // Daily Motion
            file: "https://api.dmcdn.net/all.js",
            file: "js/dm.js",
            // Vimeo
            file: "https://player.vimeo.com/api/player.js",
            file: "js/vimeo.js",
            // HTML5 Player
            file: "js/html5.js"

        })
    </script>

</body>

</html>
